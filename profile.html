<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profilo Utente</title>
    <script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-firestore-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
</head>
<body>
    <div id="profile-info">
        <!-- Info utente mostrate qui -->
    </div>
    <div class="canvas-container flex items-center justify-center mx-4 relative">
    </div>

    <!-- Carica Firebase e p5.js -->


    
</body>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBhYGRUm7zDnP6GNf-nUGTxgwRvdwApnH4",
        authDomain: "datacracy-16f27.firebaseapp.com",
        projectId: "datacracy-16f27",
        storageBucket: "datacrazia-16f27.appspot.com",
        messagingSenderId: "643675743445",
        appId: "1:643675743445:web:ada84b9922f1938eb0ee5c",
        measurementId: "G-VFQQ01LNZ4"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let red, green, blue, redMold, greenMold, blueMold;

    let score = 5000
    // let red = 0
    // let green = 0
    // let blue = 0
    // let redMold = 255
    // let greenMold = 255
    // let blueMold = 255

    auth.onAuthStateChanged((user) => {
    if (user) {
        const userId = user.uid;
        displayProfileInfo(user);
        loadP5Params(userId);  // Carica i parametri di p5.js
    } else {
        window.location.href = "login.html";
    }
    });


    function displayProfileInfo(user) {
        document.getElementById('profile-info').innerHTML = `
            <p><strong>Email:</strong> ${user.email}</p>
        `;
    }

    function loadP5Params(userId) {
        console.log("Caricando i parametri per l'utente:", userId);
        db.collection('responses').doc(userId).get()
        .then((doc) => {
            if (doc.exists) {
                console.log("Dati trovati:", doc.data());
                const params = doc.data().p5Params;

                // Controlla se i parametri sono validi
                // score = params.score || 0;
                red = params.red || 30;
                green = params.green || 30;
                blue = params.blue || 30;
                redMold = params.redMold || 160;
                greenMold = params.greenMold || 160;
                blueMold = params.blueMold || 160;

                // Log per verificare i valori
                console.log(`score: ${score}, red: ${red}, green: ${green}, blue: ${blue}`);
                console.log(`redMold: ${redMold}, greenMold: ${greenMold}, blueMold: ${blueMold}`);

                initializeP5(); 
            } else {
                console.error("Nessun dato trovato per questo utente!");
            }
        })
        .catch((error) => {
            console.error("Errore nel recupero dei dati:", error);
        });
    };

    
</script>
<script src="sketch2.js"></script>
</html>
