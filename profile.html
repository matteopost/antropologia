<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Axis - Profile</title>
    <script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-firestore-compat.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br w-screen h-screen from-violet-200 from-10% via-gray-100 via-20% to-blue-200 to to-90% p-3 lg:p-4">

    <!-- NAV -->
    <div x-data="{ dropdown: false }">
      <div
        class="flex px-4 lg:px-6 py-1 lg:py-2 justify-between border-white border-x bg-white/30 backdrop-blur-lg rounded-2xl shadow-md"
      >
        <div>
          <a href="/index.html" class="hover:opacity-60 transition-opacity">
            <img
              src="./assets/svg/axis-logo.svg"
              alt="logo axis"
              class="h-8 lg:h-10 mt-2 mb-1 mx-1"
            />
          </a>
        </div>
    
        <div class="flex items-center gap-3 text-base lg:text-xl ">
          <div>
            <p class=" hover:text-blue-500 transition-colors cursor-pointer"
            @click="dropdown = !dropdown"
            >
              Edoardo
            </p>
          </div>
    
          <div
            class="bg-gray-300 rounded-full size-10 font-light text-slate-100 flex items-start cursor-pointer"
            @click="dropdown = !dropdown"
          >
            <p class="m-auto">EB</p>
          </div>
        </div>
      </div>
    
      <div
        class="flex absolute top-22 right-4 ml-auto flex-col mt-2 w-40 border-white border-x bg-white/30 backdrop-blur-lg rounded-2xl shadow-md divide-y divide-gray-300"
        x-show="dropdown"
        x-cloak
        @click.away="dropdown = false"
        x-transition:enter="transition ease-out duration-200"
        x-transition:enter-start="opacity-50 "
        x-transition:enter-end="opacity-100 "
        x-transition:leave="transition ease-in duration-200"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-50 "
        style="display: none;"
      >
        <div class="w-full py-2 px-6">
          <a href="/profile.html" class="hover:text-blue-500 transition-colors">
            Profile
          </a>
        </div>
        <div class="w-full py-2 px-6">
          <a
            href="/profile.html"
            class="text-red-400 hover:text-red-600 transition-colors"
          >
            Logout
          </a>
        </div>
      </div>
    </div>
    
    

    <div class="">
        <a href="/index.html">Home</a>
    </div>
    <div id="profile-info">
        <!-- Info utente mostrate qui -->
    </div>
    <div class="canvas-container flex items-center justify-center mx-4 relative">
    </div>


    
</body>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBhYGRUm7zDnP6GNf-nUGTxgwRvdwApnH4",
        authDomain: "datacracy-16f27.firebaseapp.com",
        projectId: "datacracy-16f27",
        storageBucket: "datacrazia-16f27.appspot.com",
        messagingSenderId: "643675743445",
        appId: "1:643675743445:web:ada84b9922f1938eb0ee5c",
        measurementId: "G-VFQQ01LNZ4"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let score = 0, red, green, blue, redMold, greenMold, blueMold;
    let num = score;

    auth.onAuthStateChanged((user) => {
    if (user) {
        const userId = user.uid;
        displayProfileInfo(user);
        loadP5Params(userId);  // Carica i parametri di p5.js
    } else {
        window.location.href = "login.html";
    }
    });


    function displayProfileInfo(user) {
        document.getElementById('profile-info').innerHTML = `
            <p><strong>Email:</strong> ${user.email}</p>
        `;
    }

    function loadP5Params(userId) {
        console.log("Caricando i parametri per l'utente:", userId);
        db.collection('responses').doc(userId).get()
        .then((doc) => {
            if (doc.exists) {
                console.log("Dati trovati:", doc.data());
                const params = doc.data().p5Params;

                // Controlla se i parametri sono validi
                score = params.score || 0;
                red = params.red || 30;
                green = params.green || 30;
                blue = params.blue || 30;
                redMold = params.redMold || 160;
                greenMold = params.greenMold || 160;
                blueMold = params.blueMold || 160;

                // Log per verificare i valori
                console.log(`score: ${score}, red: ${red}, green: ${green}, blue: ${blue}`);
                console.log(`redMold: ${redMold}, greenMold: ${greenMold}, blueMold: ${blueMold}`);
                initializeP5();
            } else {
                console.error("Nessun dato trovato per questo utente!");
            }
        })
        .catch((error) => {
            console.error("Errore nel recupero dei dati:", error);
        });
    };

    
</script>
<script src="sketch2.js"></script>
</html>
